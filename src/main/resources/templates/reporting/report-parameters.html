<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}"
      th:with="section='orders',subSection='reports',title=${pageTitle},sectionTitle=#{main.general.mainmenu.orders.text}">
<main layout:fragment="content">
  <div class="card">
    <div class="card-header">
      <div class="d-flex align-items-center gap-2">
        <h2 class="m-0" th:text="${report.name}">Report</h2>
      </div>
    </div>
    <div class="card-header">
      <details>
        <summary>Show SQL</summary>
        <code th:text="${report.sql}">SELECT ...</code>
      </details>
    </div>
    <div class="card-body">
      <form th:action="@{/reporting/reports/execute}" th:object="${execute}" method="post">
        <input type="hidden" th:field="*{reportId}" />
        <!-- preserve list filter across execute/back navigation -->
        <input type="hidden" name="filter" th:if="${filter}" th:value="${filter}" />

        <div class="table-responsive">
          <table class="table table-vcenter">
            <thead>
            <tr>
              <th>Name</th>
              <th>Type</th>
              <th>Value</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="p,i : *{parameters}">
              <td><input class="form-control" type="text" th:field="*{parameters[__${i.index}__].name}" /></td>
              <td>
                <select class="form-select" th:field="*{parameters[__${i.index}__].type}">
                  <option value="string">string</option>
                  <option value="date">date</option>
                  <option value="number">number</option>
                </select>
              </td>
              <td><input class="form-control" type="text" th:field="*{parameters[__${i.index}__].value}" /></td>
            </tr>
            </tbody>
          </table>
        </div>

        <div class="alert alert-info" th:if="${missingParameters}">
          Missing parameters: <span th:text="${#strings.listJoin(missingParameters, ', ')}">param1,param2</span>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">
            <i class="icon ti ti-player-play"></i> Execute
          </button>
          <a th:href="@{'/reporting/reports'(filter=${filter})}" class="btn btn-secondary">Back</a>
        </div>
      </form>
    </div>
  </div>
</main>
</html>
