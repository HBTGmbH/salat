databaseChangeLog:
  - changeSet:
      id: 1
      author: kr
      comment: Remove not used tables
      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: monthlyreport
      changes:
        - dropColumn:
            tableName: employee
            columnName: jira_oauthtoken
        - dropColumn:
            tableName: timereport
            columnName: TICKET_ID
        - dropTable:
            tableName: monthlyreport
            cascadeConstraints: true
        - dropTable:
            tableName: projectid
            cascadeConstraints: true
        - dropTable:
            tableName: referenceday_timereport
            cascadeConstraints: true
        - dropTable:
            tableName: ticket
            cascadeConstraints: true
        - dropTable:
            tableName: worklog
            cascadeConstraints: true
        - dropTable:
            tableName: worklogmemory
            cascadeConstraints: true
  - changeSet:
      id: 2
      author: kr
      comment: Add audit columns to align all entities
      preConditions:
        - onFail: MARK_RAN
        - not:
            columnExists:
              tableName: referenceday
              columnName: createdby
      changes:
        - addColumn:
            tableName: referenceday
            columns:
              - column:
                  name: createdby
                  type: varchar(255)
              - column:
                  name: lastupdatedby
                  type: varchar(255)
              - column:
                  name: lastupdate
                  type: datetime
              - column:
                  name: created
                  type: datetime
              - column:
                  name: updatecounter
                  type: int
        - addColumn:
            tableName: vacation
            columns:
              - column:
                  name: createdby
                  type: varchar(255)
              - column:
                  name: lastupdatedby
                  type: varchar(255)
              - column:
                  name: lastupdate
                  type: datetime
              - column:
                  name: created
                  type: datetime
              - column:
                  name: updatecounter
                  type: int
        - addColumn:
            tableName: workingday
            columns:
              - column:
                  name: createdby
                  type: varchar(255)
              - column:
                  name: lastupdatedby
                  type: varchar(255)
              - column:
                  name: lastupdate
                  type: datetime
              - column:
                  name: created
                  type: datetime
              - column:
                  name: updatecounter
                  type: int
        - addColumn:
            tableName: publicholiday
            columns:
              - column:
                  name: createdby
                  type: varchar(255)
              - column:
                  name: lastupdatedby
                  type: varchar(255)
              - column:
                  name: lastupdate
                  type: datetime
              - column:
                  name: created
                  type: datetime
              - column:
                  name: updatecounter
                  type: int
        - addColumn:
            tableName: overtime
            columns:
              - column:
                  name: lastupdatedby
                  type: varchar(255)
              - column:
                  name: lastupdate
                  type: datetime
              - column:
                  name: updatecounter
                  type: int
  - changeSet:
      id: 3
      author: kr
      comment: Drop not used table invoice
      preConditions:
        - onFail: MARK_RAN
        - tableExists:
            tableName: invoice
      changes:
        - dropTable:
            cascadeConstraints: true
            tableName: invoice
  - changeSet:
      id: 4
      author: kr
      comment: Remove sort of work
      preConditions:
        - onFail: MARK_RAN
        - columnExists:
            tableName: timereport
            columnName: sortofreport
      changes:
        -  dropColumn:
             tableName:  timereport
             columnName:  sortofreport
  - changeSet:
      id: 5
      author: kr
      comment: Hourly rate feature removed
      preConditions:
        - onFail: MARK_RAN
        - columnExists:
            tableName: customerorder
            columnName: currency
      changes:
        - dropColumn:
            tableName:  customerorder
            columnName:  currency
        - dropColumn:
            tableName:  customerorder
            columnName:  hourly_rate
        - dropColumn:
            tableName:  suborder
            columnName:  currency
        - dropColumn:
            tableName:  suborder
            columnName:  hourly_rate
  - changeSet:
      id: 6
      author: kr
      comment: Ensure version column has at least value 0
      changes:
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: customer
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: customerorder
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: employee
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: employeecontract
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: employeeorder
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: employeeordercontent
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: overtime
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: publicholiday
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: referenceday
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: statusreport
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: suborder
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: timereport
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: vacation
            where: updatecounter is null
        - update:
            columns:
              - column:
                  name: updatecounter
                  valueNumeric: 0
            tableName: workingday
            where: updatecounter is null
  - changeSet:
      id: 7
      author: kr
      comment: Introduce daily working time in minutes
      changes:
        - addColumn:
            tableName: employeecontract
            columns:
              - column:
                  name: dailyWorkingTimeMinutes
                  type: int
        - update:
            columns:
              - column:
                  name: dailyWorkingTimeMinutes
                  valueComputed: ROUND(dailyWorkingTime * 60)
            tableName: employeecontract
            where: dailyWorkingTimeMinutes is null
        - addNotNullConstraint:
            tableName: employeecontract
            columnName: dailyWorkingTimeMinutes
            columnDataType: int
        - dropColumn:
            tableName: employeecontract
            columnName: dailyWorkingTime
